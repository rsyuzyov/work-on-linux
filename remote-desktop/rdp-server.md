# Организация терминального сервера (Remote Desktop Services)

## Что есть
- [xrdp]()
- [x2go]()
- [LTSP]()
- [...]()

## Исходные данные
- ОС: debian 9
- DE: xfce (можно выбрать установку сразу при установке ОС или доставить позже: sudo apt install xfce)
- Домен: contoso.com
- Учетная запись администратор домена: adadmin
- 2 DC: dc1 (192.1.1.1) и dc2 (192.1.1.2)
- имя сетевой карты: etho (посмотреть: ifconfig)

О выборе DE (desktop environment, окружение рабочего стола): изначально на тестирование всех DE было выделено очень много времени, тестировались все возможные варианты на предмет жоркости (память, процессор) и стабильности именно при работе через xrdp. Лучшим был признан lxde, второе место занял xfce, третье - mate. Gnome и kde оказались ожидаемо более ресурсоемкими и медленными, но разница оказалась не сверхбольшой и работать с ними теоретически вполне можно. Cinnamon, deepin, pantheon и еще несколько работали нестабильно, либо отказывались работать совсем. Fluxbox, openbox и подобные были отсеяны по причине запредельной визуальной убогости.
В итоге был выбран lxde, но он имел один изъян - болезнь "прячущихся" модальных окон, это когда окна при открытии скрываются за уже открытыми формами. Это болячка известна многим пользователям remote desktop на windows и было странно ее здесь видеть, при этом оставалась надежда на скорее ее решение... Прошли годы, решение так и не появилось и xfce постепенно занял место победителя.

## Готовим сеть
в /etc/network/interfaces в конец добавить:
```
dns-nameservers 192.1.1.1 192.1.1.2
dns-search contoso.com
```

sudo ifdown eth0 && sudo ifup eth0

Проверка: "cat /etc/resolv.conf | grep nameserver" должен вернуть:
```
nameserver 192.1.1.1
nameserver 192.1.1.2
```

## Ставим xrdp
Чтобы использовать свежие пакеты, подключаем backports и ставим xrdp оттуда:
```
sudo echo "deb http://ftp.debian.org/debian/ stretch-backports main contrib non-free" > /etc/apt/sources.list.d/backports.list
sudo apt update 
sudo apt -t stretch-backports install xrdp -y
```

## Сеанс, не засыпай
Если терминальный сеанс перейдет в режим энергосбережения и "выключит" монитор, то разбудить его уже не удастся и придется прибивать (killall -u username). Чтобы этого избежать, нужно открыть Пуск - Настройки - Менеджер питания и на закладке "Дисплей" выключить управление питанием монитора, а также для параметра "Погасить экран через" выставить значение "никогда" (крайнее левое положение ползунка).

## Включаем в домен

Выполняем простенькую [инструкцию](join-to-domain.md)

Поскольку в этом месте стал традиционным вопрос "Это что, все что ли? А что дальше-то делать??", благословляю на вход с помощью стандартного клиента удаленных рабочих столов (mstsc) и своей доменной учетной записи. Да, учетку не забываем прописать в sudoers. Ну и переходим к [установке 1С](install-1c.md).
